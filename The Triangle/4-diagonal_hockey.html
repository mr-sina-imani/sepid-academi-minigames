<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagonal Hockey Stick - Final Step</title>
    <style>
        :root {
            --cell-size: 60px;
            --label-size: 60px;
            --gap: 10px;
            --active: #f1c40f; 
            --handle: #9b59b6;
            --blade: #e67e22;
            --bg: #fdfefe;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f3f4;
            padding: 40px;
        }

        .equation {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: #2c3e50;
            background: white;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            font-family: 'serif';
            min-width: 400px;
            text-align: center;
        }

        #grid-container {
            display: grid;
            grid-template-columns: var(--label-size) repeat(7, var(--cell-size));
            gap: var(--gap);
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            border: 1px solid #dcdde1;
            background-color: #f8f9fa;
            color: #bdc3c7;
            transition: all 0.3s ease;
        }

        .label { border: none; color: #95a5a6; font-style: italic; }
        .hidden { visibility: hidden; }
        .filled { color: #2c3e50; }

        .blade-node {
            border: 4px solid var(--blade) !important;
            color: var(--blade) !important;
            background-color: white !important;
        }

        .handle-node {
            background-color: var(--handle) !important;
            color: white !important;
            border-color: #8e44ad;
        }

        .active-node {
            background-color: var(--active) !important;
            color: #2c3e50 !important;
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        button { margin-top: 30px; padding: 12px 24px; cursor: pointer; border-radius: 5px; border: none; background: #34495e; color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div class="equation" id="eq">Target: C(6, 4) = 15</div>

    <div id="grid-container"></div>

    <button onclick="location.reload()">Reset Diagonal Proof</button>

    <script>
        const maxN = 7; 
        const container = document.getElementById('grid-container');
        let activeN = 6, activeR = 4;
        let isFinalStep = false;

        function getVal(n, r) {
            if (r < 0 || r > n) return 0;
            if (r === 0 || r === n) return 1;
            return getVal(n-1, r-1) + getVal(n-1, r);
        }

        // Build Grid
        container.innerHTML = '<div class="hidden"></div>';
        for(let r=0; r<maxN; r++) container.innerHTML += `<div class="cell label">r=${r}</div>`;
        for(let n=0; n<maxN; n++) {
            container.innerHTML += `<div class="cell label">n=${n}</div>`;
            for(let r=0; r<maxN; r++) {
                const isHidden = r > n;
                container.innerHTML += `<div id="c-${n}-${r}" class="cell ${isHidden ? 'hidden' : 'filled'}">${isHidden ? '' : getVal(n, r)}</div>`;
            }
        }

        const startNode = document.getElementById('c-6-2');
        startNode.classList.add('blade-node', 'active-node');
        startNode.onclick = expand;

        function expand() {
            const current = document.getElementById(`c-${activeN}-${activeR}`);
            current.classList.remove('active-node');
            current.onclick = null;

            if (isFinalStep) {
                // The last click: C(k+1, 0) becomes C(k, 0)
                const finalN = activeN - 1;
                document.getElementById(`c-${finalN}-0`).classList.add('handle-node');
                document.getElementById('eq').innerHTML = "<b>Proof Complete!</b> Final step: C(k+1, 0) = C(k, 0)";
                return;
            }

            const keepN = activeN - 1, keepR = activeR;
            const nextN = activeN - 1, nextR = activeR - 1;

            document.getElementById(`c-${keepN}-${keepR}`).classList.add('handle-node');

            if (nextR === 0) {
                // Reach the left border - one more expansion available
                isFinalStep = true;
                activeN = nextN; activeR = nextR;
                const next = document.getElementById(`c-${activeN}-${activeR}`);
                next.classList.add('active-node');
                next.onclick = expand;
                document.getElementById('eq').innerHTML = `Final term: C(${activeN}, 0). One more expansion...`;
            } else {
                activeN = nextN; activeR = nextR;
                const next = document.getElementById(`c-${activeN}-${activeR}`);
                next.classList.add('active-node');
                next.onclick = expand;
                updateEq();
            }
        }

        function updateEq() {
            let str = "C(6,4) = ... + ";
            str += `C(${activeN}, ${activeR})`;
            document.getElementById('eq').innerHTML = str;
        }
    </script>
</body>
</html>
